# 2026-02-19

## Full Repo Audit & Cleanup

- **TOOLS.md trimmed** — was 250+ words of placeholder examples with no real content.
- **PROJECT_MAP.md updated** — reflects new 5-agent architecture, current milestones.
- **Stale files renamed .DELETE** — configuration-check.md, implementation.md
  (old optimization checklists no longer relevant). Delete manually:
  `rm ~/.openclaw/workspace/*.DELETE`
- **Duplicate memory dirs** — root-level `memory/` is identical to `workspace/memory/`.
  Delete manually: `rm -rf ~/.openclaw/memory/`
- **SKILL_old.md.bak** — still needs deletion: `rm ~/.openclaw/skills/smart-routing/SKILL_old.md.bak`

## Tool Re-Evaluation

- **All agents switched to allowlists** — coder and communicator were on deny lists
  (implicit allow). Now every agent uses explicit allow lists for least privilege.
- **Coder lost exec** — coder writes code, sysadmin runs it. Clean separation of concerns.
  Coder tools: read, write, edit, apply_patch, memory_search.
- **Communicator switched to allowlist** — read, message, email, web_fetch, memory_search.

## Memory System Fully Initialized

- **memorySearch config fixed** — temporalDecay moved inside query.hybrid (was top-level),
  added MMR diversity reranking (lambda 0.7), embedding cache (50k entries), Gemini API key
  reference (${GEMINI_API_KEY}), candidateMultiplier 4.
- **memoryFlush upgraded** — prompt now promotes durable facts to MEMORY.md in addition to
  daily logs. Two-layer awareness: MEMORY.md for permanent, daily for context.
- **compaction.reserveTokensFloor** added (20k tokens).
- **MEMORY.md created** — distilled all 5 days of daily logs into long-term sections:
  user preferences, architecture decisions, security, infrastructure, lessons learned.
- **Weekly consolidation cron** — isolated job, Sundays 3am CST, Groq Llama 70B.
  Reads last 7 days of daily logs, promotes durable facts to MEMORY.md, reviews ERRORS.md,
  flags stale errors, archives resolved ones older than 30 days.
- **Memory management section** added to AGENTS.md — documents two-layer system.
- **GEMINI_API_KEY** added to env.template.

## Memory & Cost Config (earlier session)

- **memorySearch enabled** — Gemini embeddings (gemini-embedding-001), hybrid search
  (70% vector / 30% BM25), 30-day temporal decay. Free with existing Google auth.
- **memoryFlush model set** — openrouter/z-ai/glm-4.7-flash (~$0.07/M). Fires on
  compaction at 35k tokens.
- **Thinking disabled** on all non-coder models.

## PIN Verification

- **requirePinForExternal** added to gateway.auth — Telegram, WhatsApp, Gmail all require
  4-digit PIN prefix. Format: `1234 - your command`. Rate limited at 5 attempts.
- **PROMPT_PIN** added to env.template as ${PROMPT_PIN}.

## Self-Healing

- **ERRORS.md created** — structured error log with format: [DATE] AREA | what | fix | status.
  Seeded with 4 historical errors from previous sessions.
- **Auto-retry** — coordinator retries failed agent spawns once (fallback model), then logs.
- **Correction capture** — user corrections logged to ERRORS.md and promoted if durable.
- **Pre-task review** — coordinator checks ERRORS.md before spawning agents.
- **Weekly cron updated** to also review and archive errors.

## Self-Modification & Recovery

- **STABILITY.md rewritten** with three self-modification tiers:
  Tier 1 (workspace files) = auto. Tier 2 (config tweaks) = do + git commit + notify.
  Tier 3 (security/providers/agents) = ask user first.
- **Mandatory rollback protocol** — backup openclaw.json before Tier 2/3 changes,
  git commit before and after, validate with openclaw doctor, auto-rollback on failure.
- **BOOTSTRAP.md recovery** — if agent detects broken state, writes recovery steps
  for next session. Coordinator checks for BOOTSTRAP.md on every session start.
- **Sysadmin designated** as sole config modification agent.
- **Auto-recovery section** added to AGENTS.md — diagnose, rollback, bootstrap, restart.

## Multi-Agent Routing Research

- Reviewed docs.openclaw.ai/concepts/multi-agent — different pattern from our sub-agent
  spawning. Channel-based routing (bindings) for multiple independent agents vs task
  delegation within one agent.
- **Future plan documented** in PROJECT_MAP.md: multi-user gateway where each user brings
  their own API keys and gets isolated agent/workspace via bindings.

## Researcher Fixed (earlier session)

- Moved researcher primary off shared CLI pool to google-antigravity/gemini-3-pro-high.

## Quiet Hours (earlier session)

- HEARTBEAT.md — no notifications 23:00-08:00 CST.

## Security Hardening (earlier session)

- Prompt injection defense, email whitelist, logging redaction, filesystem hardening.

## Production Status

Config is production-ready pending:
1. Fill in ~/.openclaw/.env (OPENROUTER, GROQ, GEMINI, ANTHROPIC, PROMPT_PIN)
2. Register cron: `bash setup/cron-memory-consolidation.sh`
3. Run `openclaw doctor` to validate
4. Clean up stale files
5. Lock permissions: `chmod 700 ~/.openclaw && chmod 600 ~/.openclaw/openclaw.json ~/.openclaw/.env`
6. Push to GitHub (needs PAT or SSH key)
